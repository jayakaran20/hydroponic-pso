<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hydroponic Agriculture - CNN-PSO Optimization</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        header {
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 5px;
        }

        header p {
            font-size: 1.1em;
            color: #ddd;
        }

        .container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-tabs button {
            padding: 12px 24px;
            background: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .nav-tabs button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .nav-tabs button.active {
            background: #667eea;
            color: white;
        }

        .content-section {
            display: none;
            background: white;
            border-radius: 10px;
            padding: 40px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .content-section.active {
            display: block;
        }

        .card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
        }

        .card h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .form-group {
            margin: 15px 0;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        input[type="number"],
        input[type="file"],
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
        }

        button.btn {
            background: #667eea;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
            margin-top: 20px;
        }

        button.btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(102, 126, 234, 0.4);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .metric-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .metric-box h4 {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .metric-box .value {
            font-size: 2em;
            font-weight: bold;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-healthy { background: #28a745; }
        .status-unhealthy { background: #dc3545; }
        .status-warning { background: #ffc107; }

        .result-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .model-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .model-card {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 20px;
        }

        .model-card h4 {
            color: #667eea;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            display: none;
        }

        .alert.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .alert.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        @media (max-width: 768px) {
            .model-comparison {
                grid-template-columns: 1fr;
            }

            header h1 {
                font-size: 1.8em;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .nav-tabs button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>ğŸŒ± Hydroponic Agriculture ML System</h1>
        <p>Hybrid Metaheuristic Optimization of Deep Learning Models using CNN-PSO</p>
    </header>

    <div class="container">
        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="tab-btn active" onclick="showSection('overview')">Overview</button>
            <button class="tab-btn" onclick="showSection('predict')">Real-Time Prediction</button>
            <button class="tab-btn" onclick="showSection('batch')">Batch Processing</button>
            <button class="tab-btn" onclick="showSection('metrics')">Model Metrics</button>
            <button class="tab-btn" onclick="showSection('architecture')">Architecture</button>
            <button class="tab-btn active" onclick="showSection(event, 'overview')">Overview</button>
            <button class="tab-btn" onclick="showSection(event, 'predict')">Real-Time Prediction</button>
            <button class="tab-btn" onclick="showSection(event, 'batch')">Batch Processing</button>
            <button class="tab-btn" onclick="showSection(event, 'metrics')">Model Metrics</button>
            <button class="tab-btn" onclick="showSection(event, 'architecture')">Architecture</button>
        </div>

        <!-- OVERVIEW SECTION -->
        <div id="overview" class="content-section active">
            <h2>System Overview</h2>

            <div class="card">
                <h3>ğŸ“Š Project Details</h3>
                <p><strong>Title:</strong> Hybrid Metaheuristic Optimization of Deep Learning Models for Hydroponic Agriculture</p>
                <p><strong>Technology Stack:</strong> TensorFlow, Keras, PySwarms, Flask</p>
                <p><strong>Optimization Method:</strong> Particle Swarm Optimization (PSO) for CNN Hyperparameter Tuning</p>
            </div>

            <div class="card">
                <h3>ğŸ” Dataset Information</h3>
                <ul style="margin-left: 20px;">
                    <li><strong>Data Source:</strong> IoT Sensor Network from Hydroponic System</li>
                    <li><strong>Total Samples:</strong> 50,570 records</li>
                    <li><strong>Sensors:</strong> pH, TDS, Water Level, Temperature, Humidity, Water Temperature</li>
                    <li><strong>Control Variables:</strong> pH Reducer, Water Pump, Nutrients Adder, Humidifier, Exhaust Fan</li>
                    <li><strong>Target:</strong> System Health Status (Binary Classification)</li>
                </ul>
            </div>

            <div class="card">
                <h3>âš™ï¸ Model Architecture</h3>
                <p><strong>CNN Model:</strong> 3 Convolutional Layers â†’ 3 Dense Layers â†’ Binary Output</p>
                <p><strong>Baseline CNN:</strong> Default hyperparameters (Learning Rate: 0.001, Dropout: 0.3)</p>
                <p><strong>PSO Optimization:</strong> 5 Particles Ã— 10 Iterations to find optimal hyperparameters</p>
            </div>

            <div class="metrics-grid">
                <div class="metric-box">
                    <h4>Training Approach</h4>
                    <div class="value">CNN-PSO</div>
                </div>
                <div class="metric-box">
                    <h4>Input Features</h4>
                    <div class="value">6</div>
                </div>
                <div class="metric-box">
                    <h4>Optimization Iterations</h4>
                    <div class="value">10</div>
                </div>
                <div class="metric-box">
                    <h4>PSO Particles</h4>
                    <div class="value">5</div>
                </div>
            </div>
        </div>

        <!-- PREDICTION SECTION -->
        <div id="predict" class="content-section">
            <h2>Real-Time System Health Prediction</h2>

            <div class="card">
                <h3>ğŸ“ˆ Enter Sensor Readings</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div class="form-group">
                        <label for="ph">pH Level (0-14)</label>
                        <input type="number" id="ph" min="0" max="14" step="0.01" value="6.0" placeholder="6.0">
                    </div>
                    <div class="form-group">
                        <label for="tds">TDS (ppm)</label>
                        <input type="number" id="tds" min="0" step="1" value="1200" placeholder="1200">
                    </div>
                    <div class="form-group">
                        <label for="water_level">Water Level (0-3)</label>
                        <input type="number" id="water_level" min="0" max="3" step="1" value="1" placeholder="1">
                    </div>
                    <div class="form-group">
                        <label for="dht_temp">Air Temperature (Â°C)</label>
                        <input type="number" id="dht_temp" min="0" step="0.1" value="24" placeholder="24">
                    </div>
                    <div class="form-group">
                        <label for="dht_humidity">Humidity (%)</label>
                        <input type="number" id="dht_humidity" min="0" max="100" step="0.1" value="70" placeholder="70">
                    </div>
                    <div class="form-group">
                        <label for="water_temp">Water Temperature (Â°C)</label>
                        <input type="number" id="water_temp" min="0" step="0.1" value="21" placeholder="21">
                    </div>
                </div>

                <button class="btn" onclick="makePrediction()">ğŸ”® Predict Health Status</button>
            </div>

            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>Processing prediction...</p>
            </div>

            <div id="alert" class="alert"></div>

            <div id="results" class="result-section" style="display: none;">
                <h3>Prediction Results</h3>

                <div class="model-comparison">
                    <div class="model-card">
                        <h4>Baseline CNN</h4>
                        <div id="baseline-results"></div>
                    </div>
                    <div class="model-card">
                        <h4>PSO-Optimized CNN</h4>
                        <div id="optimized-results"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- BATCH PROCESSING SECTION -->
        <div id="batch" class="content-section">
            <h2>Batch Processing</h2>

            <div class="card">
                <h3>ğŸ“ Upload CSV File</h3>
                <p>Upload a CSV file with columns: pH, TDS, water_level, DHT_temp, DHT_humidity, water_temp</p>

                <div class="form-group">
                    <label for="csv-file">Select CSV File</label>
                    <input type="file" id="csv-file" accept=".csv">
                </div>

                <button class="btn" onclick="processBatch()">âš¡ Process Batch</button>
            </div>

            <div id="batch-alert" class="alert"></div>

            <div id="batch-results" class="result-section" style="display: none;">
                <h3>Batch Processing Results</h3>
                <div id="batch-content"></div>
            </div>
        </div>

        <!-- METRICS SECTION -->
        <div id="metrics" class="content-section">
            <h2>Model Performance Metrics</h2>

            <div class="info-box">
                <strong>ğŸ“Œ Note:</strong> Run the full training pipeline (main.py) to generate comprehensive metrics including accuracy, precision, recall, F1-score, and convergence plots.
            </div>

            <div class="card">
                <h3>Expected Performance (From Literature)</h3>
                <div class="metrics-grid">
                    <div class="metric-box">
                        <h4>Baseline Accuracy</h4>
                        <div class="value">~90-92%</div>
                    </div>
                    <div class="metric-box">
                        <h4>Optimized Accuracy</h4>
                        <div class="value">~93-95%</div>
                    </div>
                    <div class="metric-box">
                        <h4>Improvement</h4>
                        <div class="value">+2-3%</div>
                    </div>
                    <div class="metric-box">
                        <h4>Convergence Iterations</h4>
                        <div class="value">7/10</div>
                    </div>
                </div>
            </div>

            <button class="btn" onclick="loadMetrics()">ğŸ“Š Load Saved Metrics</button>
        </div>

        <!-- ARCHITECTURE SECTION -->
        <div id="architecture" class="content-section">
            <h2>System Architecture</h2>

            <div class="card">
                <h3>ğŸ—ï¸ CNN-PSO Hybrid Architecture</h3>
                <pre style="background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto;">
Input: IoT Sensor Data (6 features)
    â†“
Data Preprocessing & Normalization
    â†“
Split: Train (60%) | Val (20%) | Test (20%)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     BASELINE CNN MODEL TRAINING         â”‚
â”‚  (Default Hyperparameters)              â”‚
â”‚  - Learning Rate: 0.001                 â”‚
â”‚  - Batch Size: 32                       â”‚
â”‚  - Dropout: 0.3                         â”‚
â”‚  - Epochs: 50                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
[Evaluation] â†’ Accuracy, Precision, Recall, F1, AUC
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PSO HYPERPARAMETER OPTIMIZATION        â”‚
â”‚  - Particles: 5                         â”‚
â”‚  - Iterations: 10                       â”‚
â”‚  - Search Space:                        â”‚
â”‚    â€¢ Learning Rate: [0.0001, 0.01]     â”‚
â”‚    â€¢ Batch Size: [16, 64]              â”‚
â”‚    â€¢ Dropout: [0.1, 0.5]               â”‚
â”‚    â€¢ Dense Units: Variable ranges       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   OPTIMIZED CNN MODEL TRAINING          â”‚
â”‚  (PSO-Tuned Hyperparameters)            â”‚
â”‚  - Epochs: 50                           â”‚
â”‚  - Best Found Hyperparameters           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
[Evaluation] â†’ Compare with Baseline
    â†“
Model Comparison & Visualization
    â†“
Flask Web Interface & Real-time Predictions
                </pre>
            </div>

            <div class="card">
                <h3>ğŸ§  CNN Layer Structure</h3>
                <pre style="background: #f5f5f5; padding: 15px; border-radius: 5px;">
Conv1D(32, kernel=3) â†’ BatchNorm â†’ MaxPool â†’ Dropout(0.3)
Conv1D(64, kernel=3) â†’ BatchNorm â†’ MaxPool â†’ Dropout(0.3)
Conv1D(128, kernel=3) â†’ BatchNorm â†’ MaxPool â†’ Dropout(0.3)
    â†“
Flatten
    â†“
Dense(256) â†’ ReLU â†’ BatchNorm â†’ Dropout(0.3)
Dense(128) â†’ ReLU â†’ BatchNorm â†’ Dropout(0.3)
Dense(64) â†’ ReLU â†’ Dropout(0.3)
    â†“
Dense(1, activation=sigmoid) â†’ Binary Output
                </pre>
            </div>
        </div>
    </div>

    <script>
        function showSection(sectionId) {
        function showSection(event, sectionId) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });

            // Remove active class from buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected section
            document.getElementById(sectionId).classList.add('active');

            // Mark button as active
            event.target.classList.add('active');
        }

        function makePrediction() {
            const data = {
                'ph': parseFloat(document.getElementById('ph').value),
                'tds': parseFloat(document.getElementById('tds').value),
                'water_level': parseInt(document.getElementById('water_level').value),
                'dht_temp': parseFloat(document.getElementById('dht_temp').value),
                'dht_humidity': parseFloat(document.getElementById('dht_humidity').value),
                'water_temp': parseFloat(document.getElementById('water_temp').value)
            };

            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';

            fetch('/api/predict', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                document.getElementById('loading').style.display = 'none';

                if (result.success) {
                    displayPredictionResults(result.predictions);
                } else {
                    showAlert('Error: ' + result.error, 'error');
                }
            })
            .catch(error => {
                document.getElementById('loading').style.display = 'none';
                showAlert('Error making prediction', 'error');
            });
        }

        function displayPredictionResults(predictions) {
            let baselineHtml = '<p><strong>Model not loaded</strong></p>';
            let optimizedHtml = '<p><strong>Model not loaded</strong></p>';

            if (predictions.baseline) {
                const b = predictions.baseline;
                baselineHtml = `
                    <p><strong>Health Status:</strong> 
                        <span class="status-indicator status-${b.health_status.toLowerCase()}"></span>
                        ${b.health_status}
                    </p>
                    <p><strong>Probability:</strong> ${(b.probability * 100).toFixed(2)}%</p>
                    <p><strong>Confidence:</strong> ${(b.confidence * 100).toFixed(2)}%</p>
                `;
            }

            if (predictions.optimized) {
                const o = predictions.optimized;
                optimizedHtml = `
                    <p><strong>Health Status:</strong> 
                        <span class="status-indicator status-${o.health_status.toLowerCase()}"></span>
                        ${o.health_status}
                    </p>
                    <p><strong>Probability:</strong> ${(o.probability * 100).toFixed(2)}%</p>
                    <p><strong>Confidence:</strong> ${(o.confidence * 100).toFixed(2)}%</p>
                `;
            }

            document.getElementById('baseline-results').innerHTML = baselineHtml;
            document.getElementById('optimized-results').innerHTML = optimizedHtml;
            document.getElementById('results').style.display = 'block';

            showAlert('Prediction completed successfully!', 'success');
        }

        function processBatch() {
            const fileInput = document.getElementById('csv-file');
            if (!fileInput.files.length) {
                showAlert('Please select a CSV file', 'error');
                return;
            }

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            fetch('/api/batch-predict', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    let html = `<p>Processed ${result.num_samples} samples</p>`;
                    document.getElementById('batch-content').innerHTML = html;
                    document.getElementById('batch-results').style.display = 'block';
                    showAlert('Batch processing completed!', 'success');
                } else {
                    showAlert('Error: ' + result.error, 'error');
                }
            })
            .catch(error => showAlert('Error processing batch', 'error'));
        }

        function loadMetrics() {
            fetch('/api/metrics')
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    console.log('Metrics loaded:', result.metrics);
                    showAlert('Metrics loaded successfully!', 'success');
                } else {
                    showAlert('No metrics available yet. Run training pipeline first.', 'error');
                }
            })
            .catch(error => showAlert('Error loading metrics', 'error'));
        }

        function showAlert(message, type) {
            const alertDiv = document.getElementById('alert');
            alertDiv.textContent = message;
            alertDiv.className = 'alert ' + type;
            setTimeout(() => alertDiv.style.display = 'none', 5000);
        }

        // Check API health on load
        window.addEventListener('load', () => {
            fetch('/api/health')
            .then(response => response.json())
            .then(data => console.log('API Health:', data))
            .catch(error => console.log('API connection error'));
        });
    </script>
</body>
</html>
